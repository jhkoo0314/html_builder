# AGENT.md

이 문서는 `C:\html_builder`의 에이전트 작업 규칙과 현재 운영 정책(안정화 기준)을 정의합니다.
최종 업데이트: 2026-02-27

## 1) 필수 공통 규칙

### 1.1 인코딩
- 모든 텍스트 파일은 UTF-8로 유지합니다.
- PowerShell로 파일 저장 시 인코딩을 명시합니다.
  - 예: `Set-Content -Encoding utf8`
- 한글/특수문자가 깨진 흔적(`�`, `占`)이 보이면 즉시 작업을 중단하고 복구합니다.

### 1.2 수정 원칙
- 요청 범위만 최소 변경합니다.
- 무관한 파일 변경, 대량 포맷 변경, 라인엔딩 전체 변경을 피합니다.
- 사용자 요청이 없으면 파괴적 명령(`reset --hard` 등)을 실행하지 않습니다.

### 1.3 품질 검증
- 변경 후 최소 로드 검증(문법/require 가능 여부)을 수행합니다.
- 실패 시 원인과 영향 범위를 명확히 남깁니다.

## 2) 현재 LLM 운영 정책 (전역)

### 2.1 모델, 예산, 타임아웃
- 모델 후보 순서: `gemini-2.5-flash` -> `gemini-3-flash-preview`
- 총 LLM 예산: `135000ms`
- 시도 기본 타임아웃: `120000ms`
- 모델별 타임아웃:
  - `gemini-2.5-flash`: `120000ms`
  - `gemini-3-flash-preview`: `15000ms`
- 요청 전체 타임아웃: `150000ms`
- Repair 타임아웃: `40000ms`

### 2.2 적용 코드 기준
- `src/config/defaults.js`
- `src/llm/gemini/client.js`
- `src/pipelines/generatePipeline.js`

### 2.3 동작 원칙
- 생성과 Repair 호출 모두 동일한 모델별 타임아웃 정책을 사용합니다.
- 예산 소진 또는 구조 검증 실패 시 fallback 경로로 전환됩니다.

## 3) 언어 출력 정책 (현재)

### 3.1 기본 원칙
- 슬라이드 본문 언어는 소스 텍스트의 지배적 언어를 따릅니다.
- 소스가 대부분 한국어면 한국어 출력 비율을 높입니다.

### 3.2 안정화 주의사항
- 언어 제약이 강해지면 구조 검증 실패(`NO_SLIDES`) 확률이 증가할 수 있습니다.
- LTS 80점 유지가 우선일 때는 구조/내비게이션/완전한 HTML 규칙을 최우선으로 둡니다.
- 언어 규칙 변경 시 fallback 비율과 `whyFallback` 분포를 함께 점검합니다.

## 4) 안정화 버전 상태

- App Version: `0.1.0`
- Stabilization Version: `v0.1.0-stable.1`
- Status: 안정화 성공(LLM 생성 성공 케이스 확인), 단 언어 제약 변경 시 fallback 재점검 필요

## 5) 작업 체크리스트

1. 요청이 코드 변경인지 설명만인지 먼저 확인
2. 변경 전 관련 설정/호출 경로를 검색(`rg`)으로 확인
3. 최소 수정으로 반영
4. 로드/스모크 검증 수행
5. 변경 파일, 영향, 리스크를 간결히 보고

## 6) 하드 스톱 규칙

아래 중 하나라도 발견되면 즉시 중단하고 사용자 확인을 요청합니다.
- 인코딩 깨짐 문자 발생
- 예상치 못한 대규모 파일 변형
- 무관한 기존 변경을 덮어써야 하는 상황
- 안정화 기준을 깨는 정책 변경 요청(과도한 제약 추가)
